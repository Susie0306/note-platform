generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")   // 运行时用连接池（6543）
  directUrl = env("DIRECT_URL")     // 迁移时用直连（5432）
}
        
// 1. 用户模型
model User {
  id        String   @id @default(uuid()) // 内部主键
  email     String   @unique
  clerkId   String   @unique              // 关联 Clerk 的用户 ID
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  notes     Note[]   // 一个人可以有很多笔记
  tags      Tag[]    // 一个人可以有很多标签
  wishes    Wish[]   // 一个人可以有很多心愿
}

// 2. 笔记模型
model Note {
  id        String   @id @default(uuid())
  title     String
  content   String?  @db.Text // 存储 Markdown 内容，允许为空
  
  // P2 AI 预留字段：用来存 AI 生成的摘要
  summary   String?  @db.Text 
  
  // 软删除标记，可为空
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // 关联关系
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  tags      Tag[]    // 一个笔记可以有多个标签
  
  // P2 AI 检索预留：先不写 vector 类型（配置较复杂），
  // 后续会在这里通过 SQL 扩展添加 embedding 字段。

  @@index([userId]) // 优化查询性能
}

// 3. 标签模型
model Tag {
  id     String @id @default(uuid())
  name   String
  
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  notes  Note[] // 多对多关系：一个标签可以对应多个笔记

  @@unique([name, userId]) // 防止同一个用户创建重名标签
  @@index([userId])
}

// 4. 心愿模型
model Wish {
  id          String    @id @default(uuid())
  title       String
  description String?   @db.Text
  targetDate  DateTime? // 目标日期
  progress    Int       @default(0) // 进度 0-100
  status      String    @default("IN_PROGRESS") // IN_PROGRESS, COMPLETED, ARCHIVED
  
  imageUrl    String?   // 愿景图 URL
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  logs        WishLog[] // 心愿的节点记录

  @@index([userId])
}

// 5. 心愿节点记录模型
model WishLog {
  id        String   @id @default(uuid())
  content   String   @db.Text
  imageUrl  String?
  
  createdAt DateTime @default(now())
  
  wishId    String
  wish      Wish     @relation(fields: [wishId], references: [id], onDelete: Cascade)
}


