# 熙记 (Xi Ji) - 项目进度与开发文档

> **最后更新时间**: 2025-12-10
> **当前版本**: v0.2.0 (特色功能初版完成)

---

## ⚠️ 关键开发注意事项 (Critical)

**关于 NPX 命令执行**：
由于当前开发环境配置特殊，**所有涉及 `npx` 的命令（如 `npx prisma generate`, `npx prisma db push` 等）必须由用户在终端手动执行**。AI 助手不能直接运行这些命令。

**协同编辑环境变量**：
已接入 Liveblocks + Yjs 协同，需在环境变量中配置 `LIVEBLOCKS_SECRET_KEY`，前端通过 `/api/liveblocks-auth` 获取令牌。

---

## 1. 产品文档

### 1.1 核心理念
**“以笔记为载体，守护每一份小希冀”**
熙记不仅是一个知识笔记工具，更是一个守护用户情感和“小希冀”的载体。产品设计围绕“实用性”与“情感化”双核心。

### 1.2 产品愿景 (用户原稿)
*   **基础功能**：多元记录（支持多格式）、高效管理（智能分类与标签）、版本回溯。
*   **特色功能**：
    *   **心愿追踪**：带时间轴的心愿笔记，设定目标节点与期限，记录奔赴美好的过程。
    *   **回忆提醒**：基于时间触发（如“去年今日”），温馨提醒重温过往。
    *   **希冀清单**：提供预设模板。
*   **跨端同步**：多端实时同步，离线编辑，数据加密安全。

### 1.3 特色功能详细设计 (v1.0 实现方案)

#### 功能一：心愿追踪 (Wish Tracker)
*   **定位**：强调“过程感”与“成就感”。
*   **入口**：侧边栏“小希冀” + 首页概览卡片。
*   **交互**：
    *   **许愿**：简单的弹窗创建，设定标题与目标日期。
    *   **时光画卷 (详情页)**：左侧垂直时间轴展示“心路历程”日志，右侧滑块更新进度。
    *   **达成**：进度 100% 时自动标记为“已达成”。

#### 功能二：回忆提醒 (Memory Capsule)
*   **定位**：强调“惊喜感”与“温情”。
*   **机制**：
    *   **优先**：寻找“去年今日”（或往年今日）的笔记。
    *   **兜底**：若无，则随机漫游到 30 天前的一条旧笔记。
*   **展现**：首页右下角浮动胶囊入口 -> 点击弹出精美信纸风格卡片。

---

## 2. 当前开发进度 (Current Status)

### 2.1 已完成功能 (Completed)

#### A. 基础设施与外观
- [x] **认证系统**：集成 Clerk，实现登录/注册/注销。
- [x] **落地页美化**：未登录状态展示“柔暖日光黄”主题落地页，包含光斑动画与磨砂玻璃效果。
- [x] **侧边栏导航**：实现了响应式侧边栏，包含“首页”、“全部笔记”、“小希冀”等入口。

#### B. 核心编辑器
- [x] **PlateJS 集成**：替换了原有的 Markdown 编辑器，实现所见即所得。
- [x] **工具栏重构**：完全使用 Plate UI 组件 (`FixedToolbar`, `MarkToolbarButton`)，支持加粗、斜体、列表等基础格式。
- [x] **GFM 支持**：配置 `remark-gfm`，修复了 strikethrough (`delete`) 节点解析报错的问题。
- [x] **实时协同 (MVP)**：接入 **Liveblocks + Yjs**，Note 编辑器支持多人同时编辑、在线状态/光标同步；RoomProvider + Plate Yjs 插件封装完成。

#### C. 特色功能：心愿追踪
- [x] **数据库**：新增 `Wish` (心愿) 和 `WishLog` (心愿日志) 表。
- [x] **后端 Logic**：`createWish`, `getWishes`, `getWish`, `updateWishProgress`, `createWishLog`。
- [x] **UI 实现**：
    - 心愿列表页 (`/wishes`)：愿景墙头部 + 卡片式列表。
    - 详情页 (`/wishes/[id]`)：时间轴日志展示 + 进度滑块 + 快捷记录框。
    - 进度条组件：集成 `@radix-ui/react-progress` 和 `@radix-ui/react-slider`。
    - **达成特效**：进度 100% 时的全屏庆祝动画 (Confetti)。
    - **希冀清单模板**：创建心愿时提供预设模板（旅行、阅读、技能、运动）。

#### D. 特色功能：回忆提醒
- [x] **算法逻辑**：`getDailyMemory` Action 实现（往年今日 > 随机漫游）。
- [x] **UI 实现**：`MemoryCapsule` 组件，包含右下角浮动入口与信纸弹窗。
- [x] **首页集成**：登录后首页自动加载回忆胶囊。

### 2.2 待办/规划中 (Backlog)
- [ ] **跨端同步优化**：目前仅依赖 Prisma/Postgres，需进一步测试多端数据一致性。
- [ ] **AI 辅助**：利用已有的 AI 模块，为心愿或回忆提供智能寄语。

---

## 3. 技术栈信息
*   **框架**: Next.js 16 (Turbopack)
*   **语言**: TypeScript
*   **数据库**: PostgreSQL + Prisma ORM
*   **UI 库**: Tailwind CSS v4, Radix UI, Lucide React
*   **编辑器**: PlateJS v52
*   **认证**: Clerk

## 4. 常用命令备忘
*   更新数据库结构：`npx prisma db push` (需手动执行)
*   生成客户端类型：`npx prisma generate` (需手动执行)
*   启动开发服务器：`npm run dev`

